Лабораторная работа №2 Управление разделами дисковой системы, создание и монтирование файловых систем
===
**Задачи:**
---
  1) Научиться создавать, изменять и удалять разделы на жестких дисках. 
  2) Научиться создавать и настраивать файловые системы. 
  3) Научиться монтировать файловые системы, находящиеся в локальном или сетевом доступе. 

**Подсказки:**
---
  1) В работе используются следующие команды (в дополнение к изученным в предыдущих лабораторных работах): blkid, dumpe2fs, e2fsck, fdisk, lvcreate, mke2fs, mkfs.ext4, mount, mount.cifs, pvcreate, resize2fs, reboot, tune2fs, umount, vgcreate. 
  2) Прочитайте документацию по указанным командам и определите их назначение до начала выполнения заданий. 
  3) Параметры автоматического монтирования файловых систем при загрузке операционной системы задаются в конфигурационном файле /etc/fstab. 
  4) Для получения подробного справочного руководства по любой команде можно набрать в консоли «man название команды», для кратной справки — название_команды -h или название_команды --help. 
  5) Для удобства работы можно пользоваться одновременно несколькими консолями. На одной консоли читать справочное руководство, на другой редактировать скрипт и т.п. Переключаться между ними можно нажатием комбинации клавиш Alt+Fn, где Fn — функциональная клавиша (F1 — для первой консоли, F2- для второй, а вот 7-я консоль обычно занята графическим интерфейсом).

**Задание:**
---
*ВНИМАНИЕ! Перед началом работы создайте снимок виртуальной машины. Рекомендуется делать снимки также перед выполнением пунктов 10 и 12 и 13.*
Создайте текстовый файл в котором запишите последовательность команд для выполнения каждого из нижеследующих заданий. Для команд, имеющих интерактивный интерфейс – опишите последовательность выбора управляющих команд и их параметров. Если решение заключается в изменении конфигурационного файла – укажите название файла и вносимые или изменяемые строки. 
Требуемые действия: 
  1. Создайте новый раздел, начинающийся с первого свободного сектора и имеющий размер 300 МБайт. 
  2. Создайте файл в домашнем каталоге пользователя root и сохраните в него UUID созданного раздела. 
  3. Создайте на созданном разделе файловую систему ext4 с размером блока 4096 байт. 
  4. Выведите на экран текущее состояние параметров, записанных в суперблоке созданной файловой системы. 
  5. Настройте эту файловую систему таким образом, чтобы ее автоматическая проверка запускалась через 2 месяца или каждое второе монтирование файловой системы. 
  6. Создайте в каталоге /mnt подкаталог newdisk и подмонтируйте в него созданную файловую систему.
  7. Создайте в домашнем каталоге пользователя root ссылку на смонтированную файловую систему 
  8. Создайте каталог с любым именем в смонтированной файловой системе. 
  9. Включите автомонтирование при запуске операционной системы созданной файловой системы в /mnt/newdisk таким образом, чтобы было невозможно запускать исполняемые файлы, находящиеся в этой системе, а также с отключением возможности записи времени последнего доступа к файлу для ускорения работы с этой файловой системой. Перезагрузите операционную систему и проверьте доступность файловой системы. Проверьте невозможность запустить исполняемый файл, если он хранится в этой файловой системе. 
  10. Увеличьте размер раздела и файловой системы до 350 МБайт. Проверьте, что размер изменился.
  11. Проверьте на наличие ошибок созданную файловую системы "в безопасном режиме", то есть в режиме запрета внесения каких-либо изменений в файловую систему, даже если обнаружены
  ошибки.
  12. Создайте новый раздел, размером в 12 Мбайт. Настройте файловую систему, созданную в пункте 3
  таким образом, чтобы ее журнал был расположен на разделе, созданном в этом пункте.
  13. Создайте два новых раздела, размером в 100 МБайт каждый.
  14. Создайте группу разделов LVM и логический том LVM над созданными в предыдущем пункте
  разделами. Создайте файловую систему ext4 для созданного логического тома LVM и
  смонтируйте её в предварительно созданный каталог supernewdisk в каталоге mnt.
  15. Создайте папку (каталог) в хостовой операционной системе и предоставьте к ней сетевой доступ,
  создав сетевой ресурс на хостовой операционной системе. Создайте в директории /mnt
  поддиректорию share и подмонтируйте в нее созданный сетевой ресурс.
  16. Сделайте так, чтобы сетевой ресурс автоматически монтировалcя для чтения при загрузке
  операционной системы. Перезагрузите операционную систему и проверьте, что автоматическое
  монтирование ресурса выполнилось.
  
**Назначение команд:**
---  
* **`BLKID`** - утилита для просмотра UUID. Показывает информацию только по нужному разделу. Её необходимо запускать от имени суперпользователя.

  **`$ sudo blkid [options] section`**
  
   **Основные опции:**
   
   * **`без_опции`** выведет на экран дисплея информацию, содержащуюся в файле /etc/blkid.tab.
   * **`-с`** - заставляет blkid читать не из файла blkid.tab, а из любого указанного файла. Скажем, /dev/null. Не имея никакой информации из данного файла, команда вынуждена будет прочитать информацию из нод устройств, то есть выдать нам реальную картину на текущий момент.
   * **`<device>`** - выдает сведения об указанном устройстве.
   * **`-t`** - найдет все устройства, отвечающие заданному критерию, будь то TYPE, LABEL, или UUID. Можно сужать круг поиска, вводя в командную строку имена интересующих устройств.
   * **`-s`** - выдаст только указанный критерий нужного устройства.
   * **`-o`** - позволяет выбирать формат вывода из трех возможных: value (значение критерия), device (устройство), или full (полный).
   * **`-l`** - применяется вместе с опцией поиска -t. Но из всего найденного выдаст сведения только об одном устройстве. Обычно это первое прочитанное в файле /etc/blkid.tab устройство.
   * **`-w`** - записывает данные в указанный вами файл, вместо файла /etc/blkid.tab.
   
---   
* **`DUMPE2FS`** - утилита для печати информации о группе супер блока и блоков для файловой системы , присутствующей на устройстве.

  **`$ sudo dumpe2fs [options] section`**
  
   **Основные опции:**
   
   * **`-b`** - используется для получения блоков, которые зарезервированы как плохие в файловой системе.
   * **`-f`** - используется, чтобы заставить dumpe2fs отображать файловую систему, даже если она может иметь некоторые флаги функций файловой системы, которые dumpe2fs может не понимать.
   * **`-h`** - он будет отображать только информацию о суперблоке, а не какую-либо подробную информацию дескриптора группы блоков.
   * **`-i`** - Используется для отображения данных файловой системы из файла изображения, созданного e2image, используя устройство в качестве пути к файлу изображения.
   * **`-x`** - отображение подробных номеров блоков информации группы в шестнадцатеричном формате.
   
---
* **`E2FSCK`** - утилита Linux для проверки файловых систем вида ext2/ext3/xet4

  **`$ e2fsck [-pacnydfvFV] [-b superblock] [-B blocksize] [-l|-L bad_blocks_file] [-C fd] device`**
  
   **Основные опции:**
   
   * **`-b`** - установить место хранения суперблока.
   * **`-B`** - установить размер единичного блока.
   * **`-v`** - подробный режим отображения.
   
---   
* **`FDISK`** - утилита для разметки дисков в Linux.

  **`$ fdisk [options] device`**
  
   **Основные опции:**
   
   * **`-B`** - не стирать первые 512 байт диска чтобы не повредить загрузочную запись
   * **`-L`** - настройка цветного вывода, возможные значения auto, never или always
   * **`-l`** - вывести все разделы на выбранных устройствах или если устройств не задано, то на всех устройствах
   * **`-o`** - указывает какие поля данных надо показывать в выводе программы, доступные поля рассмотрим ниже
   * **`-u`** - настраивает формат вывода размера разделов, доступные значения: cylinders, sectors, по умолчанию используется sectors
   * **`-w`** - режим стирания файловой системы или RAID с диска, возможные значения auto, never или always по умолчанию используется auto
   * **`-W`** - режим стирания файловой системы или RAID из только что созданного раздела. Возможные значения аналогичны предыдущей опции
   
---
* **`LVCREATE`** - утилита создает новый логический том в группе томов, выделяя логические экстенты из свободного пула физических экстентов этой группы томов.

  **`$ lvcreate -L [size] [sections_group]`**
  
   **Основные опции:**
   
   * **`-a`** - управляет доступностью логических томов для немедленного использования после завершения выполнения команды.
   * **`-c`** - предоставляет размер чанка для моментальных снимков и логических томов тонкого пула.
   * **`-C`** - устанавливает или сбрасывает непрерывную политику выделения для логических томов. 
   * **`-i`** - дает количество полос. Это значение равно количеству физических томов для рассеивания логического тома.
   * **`-l`** - дает количество килобайт для гранулярности полос. 
   * **`-L`** - предоставляет количество логических экстентов, выделяемых для нового логического тома.
   * **`-n`** - имя для нового логического тома. Без этой опции будут генерироваться имена по умолчанию «lvol #», где # — внутренний номер LVM логического тома.
   * **`-p`** - установите права доступа только для чтения или чтения и записи. По умолчанию чтение и запись.  
   
---   
* **`MKE2FS`** - утилита, позволяющая создать раздел типа ext2/ext3/ext4/ext4dev на размеченной области жёсткого диска.

  **`$ mke2fs.[fileSystem_type] [disk]`**
  
   **Основные опции:**
   
   * **`-t fs-type`** - тип создаваемой файловой системы. При этом опция -O может позволить создать файловую систему с нестандартными свойствами, которая даже не будет поддерживаться ядром Linux, например ext3 без журнала
   * **`-b`** - размер одного блока данных в байтах. Если ключ опущен, то используется значение, основанное на собранных о жёстком диске данных.
   * **`-c`** - проверка на наличие повреждённых блоков перед созданием раздела. Если ключ указан дважды, то будет проведено тщательное сканирование блоков (проверка на чтение и запись против обычной проверки чтением).
   * **`-F`** - принудительное создание файловой системы, даже если указанное устройство вовсе не является разделом.
   
---      
* **`MKFS.EXT4`** - утилита, создающая файловую систему типа ext4

  **`$ mkfs.ext4 [disk]`**
  
---    
* **`MOUNT`** - утилита, применяющаяся для монтирования файловых систем.

  **`$ sudo mount [options] device_file source_dir`**
  
   **Основные опции:**
   
   * **`-v`** - подробный режим
   * **`-a`** - примонтировать все устройства, описанные в fstab
   * **`-F`** - создавать отдельный экземпляр mount для каждого отдельного раздела
   * **`-f`** - не выполнять никаких действий, а только посмотреть что собирается делать утилита
   * **`-n`** - не записывать данные о монтировании в /etc/mtab
   * **`-U`** - монтировать раздел по UUID
   * **`-B`** - монтировать локальную папку
   * **`-R`** - перемонтировать локальную папку.
   
---
* **`mount.cifs`** - Монтирует шару cifs (общую папку)

  **`$ mount.cifs [share_folder] [output] [-o opitions]`**
  
---    
* **`pvcreate`** - Помечает диск, что он будет использоваться для LVM (Logical Volume Manager - менеджер логических томов)

  **`$ pvcreate [disks]`**
  
---      
* **`resize2fs`** - утилита для изменения размеров файловой системы ext2/ext3

  **`$ resize2fs [fileSystem]`**
  
   **Основные опции:**
   
   * **`-M`** - уменьшить файловую систему до минимального размера
   * **`-f`** - принудительное изменение, не смотря на потерю данных
   * **`-F`** - очистить буфер файловой системы
   
---      
* **`reboot`** - перезагрузка системы. Данная команда записывает в журнал логов время остановки системы, уничтожает незавершенные процессы, выполняет системный вызов sync, ждет завершения записи на диск, а только после этого прекращает работу ядра и перезагружает систему Linux.

  **`$ reboot`**
  
---  
* **`tune2fs`** - просмотр и изменение различных параметров файловых систем ext2/ext3/ext4.

  **`$ tune2fs [options] [disks]`**
  
   **Основные опции:**
   
   * **`-O`** - изменить опции файловой системы
   * **`-c`** - изменить периодичность проверок файловой системы с помощью fsck
   * **`-U`** - задать UUID файловой системы 
   * **`-L`** - изменить метку раздела
   * **`-M`** - изменить последнюю папку монтирования
   * **`-l`** - получить содержимое суперблока
   * **`-j`** - настроить параметры журнала
   * **`-J`** - создать файл журнала. Позволяет превратить файловую систему ext2 в ext3.
   
---
* **`umount`** - отмонтирует раздел. Эта команда отделяет файловую систему устройства от общей файловой системы. Размонтирование невозможно в том случае, если файловая система носителя занята, например, когда запущен какой-то процесс, используется файл подкачки или вы находитесь в текущей момент в точке монтирования этой же файловой системы.

  **`$ umount [section]`**
     
---     
* **`vgcreate`** - создание группы томов. Если PhysicalDevicePath ранее не был сконфигурирован для LVM с pvcreate, устройство будет инициализировано с теми же значениями по умолчанию, которые используются с pvcreate.

  **`$ vgcreate [groupName] [volume]`**
  
   **Основные опции:**
   
   * **`-l`** - устанавливает максимально допустимое количество логических томов в этой группе томов. 
   * **`-p`** - устанавливает максимальное количество физических томов, которые могут принадлежать этой группе томов. 
   * **`-s`** - устанавливает размер физического экстента для физических томов этой группы томов.    
