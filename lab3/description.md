Лабораторная работа № 3. Управление пользователями, группами пользователей и правами на файлы и каталоги в Linux
===
## Задачи
1) Научиться создавать, изменять и редактировать учетные записи пользователей и групп пользователей в Linux. 
2) научиться задавать атрибуты прав и владения для файлов и каталогов под конкретные задачи

## Подсказки
1) В работе используются следующие команды (в дополнение к изученным в предыдущих лабораторных работах): groupadd, useradd, groupdel, userdel, groupmod, usermod, openssl, chage, chmod, chgrp, chown, groups, id.
2) Сведения о пользователях системы и их идентификаторах (UID) хранятся в файле /etc/passwd
3) Для вывода результата работы команды или конвейера команд в новый файл используется конструкция: command > file
4) Для добавления результатов работы команды или конвейера команд в конец существующего файла используется конструкция: command >> file
5) Директория /etc/skel содержит копии различных установочных и других файлов, которые могут быть скопированы в новые домашние директории пользователей, когда программа useradd добавляет нового пользователя.
6) Для шифрования пароля можно использовать команду openssl passwd –crypt незашифрованный_пароль. Для того чтобы результат выполнения команды command2 подставить в значение параметра p команды command1 можно использовать конструкцию: command1 –p $(command2)
7) Для получения подробного справочного руководства по любой команде можно набрать в консоли «man название команды».
8) Для удобства работы можно пользоваться одновременно несколькими консолями. На одной консоли читать справочное руководство, на другой редактировать скрипт и т.п. Переключаться между ними можно нажатием комбинации клавиш Ctrl+Alt+Fn, где Fn – функциональная клавиша (F1 – для первой консоли, F2 – для второй, а вот 7-я консоль обычно занята графическим интерфейсом).

## Задание
Создать скрипт, который:
  1) выводит в файл work3.log построчно список всех пользователей в системе в следующем формате: «user NNN has id MM»; 
  2) добавляет в файл work3.log строку, содержащую дату последней смены пароля для пользователя root; 
  3) добавляет в файл work3.log список всех групп в системе (только названия групп) через запятую; 
  4) делает так, чтобы при создании нового пользователя у него в домашнем каталоге создавался файл readme.txt с текстом «Be careful!»; 
  5) создает пользователя u1 с паролем 12345678; 
  6) создает группу g1; 
  7) делает так, чтобы пользователь u1 дополнительно входил в группу g1; 
  8) добавляет в файл work3.log строку, содержащую сведения об идентификаторе и имени пользователя u1 и идентификаторах и именах всех групп, в которые он входит;
  9) делает так, чтобы пользователь user дополнительно входил в группу g1 
  10) добавляет в файл work3.log строку с перечнем пользователей в группе g1 через запятую; 
  11) делает так, что при входе пользователя u1 в систему вместо оболочки bash автоматически запускается /usr/bin/mc, при выходе из которого пользователь возвращается к вводу логина и пароля; 
  12) создает пользователя u2 с паролем 87654321; 
  13) в каталоге /home создает каталог test13, в который копирует файл work3.log два раза с разными именами (work3-1.log и work3-2.log); 
  14) сделает так, чтобы пользователи u1 и u2 смогли бы просматривать каталог test13 и читать эти файлы, только пользователь u1 смог бы изменять и удалять их, а все остальные пользователи системы не могли просматривать содержимое каталога test13 и файлов в нем. При этом никто не должен иметь права исполнять эти файлы;
  15) создает в каталоге /home каталог test14, в который любой пользователь системы сможет записать данные, но удалить любой файл сможет только пользователь, который его создал или пользователь u1; 
  16) копирует в каталог test14 исполняемый файл редактора nano и делает так, чтобы любой пользователь смог изменять с его помощью файлы, созданные в пункте 13; 
  17) создает каталог test15 и создает в нем текстовый файл /test15/secret_file. Делает так, чтобы содержимое этого файла можно было вывести на экран, используя полный путь, но чтобы узнать имя этого файла, было бы невозможно.
  
Отдельно создать второй скрипт, который полностью уничтожает результаты деятельности предыдущего: удаляет созданных пользователей и их домашние каталоги, удаляет созданные группы, удаляет все созданные в предыдущем скрипте файлы и каталоги.

## Команды
* **`groupadd`** - утилита для создания новых групп

  **`$ groupadd [options] group_name`**
  
   **Основные опции:**
   
   * **`-f`** - 
   * **`-g`** - Числовое значение идентификатора группы. Значение должно быть уникальным, если не задан параметр -o. Значение должно быть не отрицательным. По умолчанию, берётся значение больше 999 и больше идентификатора любой другой группы. Значения от 0 и до 999 обычно зарезервированы под системные группы.
   * **`-K`** - Изменить значения по умолчанию (GID_MIN, GID_MAX и другие), которые хранятся в файле /etc/login.defs. Можно указать несколько параметров -K.
   * **`-o`** - Разрешает добавить группу с неуникальным GID
   * **`-p`** - Добавляет зашифрованный пароль
   
===   
* **`useradd`** - добавление нового регистрационного имени пользователя в системе 

  **`$ useradd [options] reg_name`**
  
   **Основные опции:**
   
   * **`-u`** - Идентификационный номер пользователя (UID). Этот номер должен быть неотрицательным целым числом, не превосходящим MAXUID, определенный в sys/param.h. По умолчанию используется следующий доступный (уникальный) не устаревший UID, больший 99. Эта опция игнорируется, если новое регистрационное имя будет администрироваться сетевой информационной службой (NIS).
   * **`-o`** - Эта опция позволяет сдублировать UID (сделать его не уникальным). Поскольку защита системы в целом, а также целостность контрольного журнала (audit trail) и учетной информации (accounting information) в частности, зависит от однозначного соответствия каждого UID определенному лицу, использовать эту опцию не рекомендуется (чтобы обеспечить учет действий пользователей).
   * **`-g`** - Целочисленный идентификатор или символьное имя существующей группы. Эта опция задает основную группу (primary group) для нового пользователя. По умолчанию используется стандартная группа, указанная в файле /etc/default/useradd. Эта опция игнорируется, если новое регистрационное имя будет администрироваться сетевой информационной службой (NIS).
   * **`-d`** - Начальный каталог (home directory) нового пользователя. Длина этого поля не должна превосходить 256 символов. По умолчанию используется HOMEDIR/рег_имя, где HOMEDIR - базовый каталог для начальных каталогов новых пользователей, а рег_имя - регистрационное имя нового пользователя.
   * **`-s`** - Полный путь к программе, используемой в качестве начального командного интерпретатора для пользователя сразу после регистрации. Длина этого поля не должна превосходить 256 символов. По умолчанию это поле - пустое, что заставляет систему использовать стандартный командный интерпретатор /usr/bin/sh. В качестве значения shell должен быть указан существующий выполняемый файл.
   * **`-m`** - Создает начальный каталог нового пользователя, если он еще не существует. Если каталог уже существует, добавляемый пользователь должен иметь права на доступ к указанному каталогу.
   * **`-f`** - Максимально допустимое количество дней между использованиями регистрационного имени, когда это имя еще не объявляется недействительным. Обычно в качестве значений используются положительные целые числа.
   * **`-i`** - Позволяет использовать устаревший идентификатор UID.  
     
===     
* **`groupdel`** - удаление определения группы из системы. Команда groupdel удаляет определение группы из системы путем удаления записи о соответствующей группе из файла /etc/group. Она, однако, не удаляет идентификатор группы (GID) из файла паролей; удаленный GID действует для всех файлов и каталогов, которые его имели.

  **`$ groupdel group_name`**
  
===     
* **`userdel`** - удаляет определение регистрационного имени пользователя из системы. 

  **`$ userdel [options] reg_name`**
  
   **Основные опции:**
   
   * **`-r`** - Удалить начальный каталог пользователя из системы. Этот каталог должен существовать. После успешного выполнения команды файлы и подкаталоги в начальном каталоге будут недоступны.
   * **`-n months`** - Задает, сколько месяцев идентификатор пользователя должен устаревать перед повторным использованием. Задайте -1, чтобы указать, что идентификатор пользователя никогда не должен использоваться повторно. Задайте 0, чтобы указать, что идентификатор пользователя можно немедленно повторно использовать. Если опция -n не задана, идентификатор будет устаревать стандартное количество месяцев перед повторным использованием.

===
* **`groupmod`** - изменение определения группы в системе

  **`$ groupmod [options] group_name`**
  
   **Основные опции:**
   
   * **`-g`** - 	Идентификатор новой группы. Этот идентификатор группы должен быть неотрицательным десятеричным целым числом, не превышающим значения MAXUID, определенного в заголовочном файле param.h. По умолчанию выделяется уникальный идентификатор группы в допустимом диапазоне. Идентификаторы групп в диапазоне 0-99 зарезервированы.
   * **`-o`** - Эта опция позволяет задавать дублирующийся (не уникальный) идентификатор группы.
   * **`-n`** - Строка печатных символов, задающая новое имя для группы.
   
===   
* **`usermod`** - изменение регистрационной информации о пользователе в системе

  **`$ usermod [options] reg_name`**
  
   **Основные опции:**
    ПРИМЕЧАНИЕ: Эту команду необходимо вызывать с опцией -U, чтобы изменялся идентификатор пользователя (UID) для каталогов и файлов, которыми владеет пользователь с изменяемым идентификатором; в противном случае, эти изменения должен будет выполнить администратор системы.
   * **`-u`** - Идентификационный номер пользователя (UID).
   * **`-o`** - Эта опция позволяет сдублировать указанный UID (сделать его не уникальным)
   * **`-U`** - При задании этой опции проверяется список путей, указанных в /etc/default/usermod. Для любых файлов или каталогов в указанных в списке путях, владельцем которых является пользователь со старым UID, идентификатор владельца будет изменен на новый. В список путей обычно входит начальный каталог пользователя и файл почтовых сообщений. Эта опция также отключает файл crontab для старого UID и снова включает его с новым идентификатором. Когда используется эта опция, должна быть также указана опция -u.
   * **`-G`** - Один или несколько элементов в списке через запятую, каждый из которых представляет собой целочисленный идентификатор или символьное имя существующей группы.
   * **`-d`** - Новый начальный каталог для пользователя. Длина этого поля не должна превышать 256 символов.
   * **`-s`** - Полный путь к программе, используемой в качестве начального командного интерпретатора для пользователя сразу после регистрации.
      
===      
* **`openssl`** - это система защиты и сертификации данных

   **Основные опции:**
   
   * **`-rsa, -dsa, -dsaparam`** - создавать и управлять ключами RSA и DSA
   * **`-req`** - создавать сертификаты формата x509, запросы на сертификацию, восстановление
   * **`-enc, -rsautl`** - зашифровывать данные с помощью симметрического или асимметрического шифрования
   * **`-dgst`** - высчитывать хеши различных типов
   * **`-s/mime`** - работать с S/MIME
   
===   
* **`chage`** - изменяет настройки срока действия пароля  

  **`$ chage [options] user`**
  
   **Основные опции:**
   
   * **`-m`** - изменяет значение mindays на минимальное число дней между сменой пароля. Значение 0 в этом поле обозначает, что пользователь может изменять свой пароль когда угодно.
   * **`-M`** - изменяет значение maxdays на максимальное число дней, в течении которых пароль еще действителен.
   * **`-d`** - изменяет значение lastday на день, когда был изменен пароль последний раз (число дней с 1 января 1970). Дата также может быть указана в формате ГГГГ-ММ-ДД (или формат, используемый в вашем регионе).
   * **`-I`** - используется для задания количества дней "неактивности", то есть дней, когда пользователь вообще не входил в систему, после которых его учетаня запись будет заблокирована.
   * **`-E`** - используется для задания даты, с которой учетная запись пользователя станет недоступной. 
   * **`-W`** - используется для задания числа дней, с которых пользователю начнет выводиться предупреждение об истечении срока действия его пароля и необходимости его изменения.
   * **`-l`** - позволяет непривилегированным пользователям определить время, когда истекает их пароль или учетная запись.
   
===
* **`chgrp`** - изменить группу файлов 

  **`$ chgrp [options] file_grp...`**
  
   **Основные опции:**
   
   * **`-R`** - Рекурсивное изменение группы для каталогов и всего их содержимого.
   * **`-c`** - Подробно описывать действия для каждого файла, чья группа действительно изменяется.
   * **`-f`** - Не выдавать сообщения об ошибке для файлов, чья группа не может быть изменена.
   * **`-h`** - Работать с самими символьными ссылками, а не с файлами, на которые они указывают. Данная опция доступна только если имеется системный вызов lchown.
   * **`-v`** - Подробно описывать действие или отсутствие действия для каждого файла.
   
===
* **`chown`** - утилита, изменяящая владельца и/или группу для каждого заданного файла.

  **`$ chown [options] user[:group] file`**
  
   **Основные опции:**
   
   * **`-R`** - Рекурсивное изменение владельца каталогов и их содержимого.
   * **`-c`** - Подробно описывать действие для каждого файла, владелец которого действительно изменяется.
   * **`-f`** - Не выдавать сообщения об ошибках для файлов, чей владелец не может быть изменен.
   * **`-h`** - Работать с самими символьными ссылками, а не с файлами, на которые они указывают. Данная опция доступна только если имеется системный вызов lchown.
   * **`-v`** - Подробное описание действия (или отсутствия действия) для каждого файла.
   
===
* **`groups`** - выдает группы, в которые входит пользователь  

  **`$ group [options] user_name`**
  
===
* **`id`** - выводит подлинные и действующие UIDы и GIDы

  **`$ id [options] user_name`**
  
   **Основные опции:**
   
   * **`-g`** - выводит только подлинный числовой идентификатор группы
   * **`-G`** - выводит все подлинные числовые идентификаторы групп, в которых состоит пользователь
   * **`-n`** - выводит действующие имена пользователей или групп. Используется совместно с опциями -ugG
   * **`-r`** - выводит подлинные числовые идентификаторы пользователей или групп. Используется совместно с опциями -ugG
   * **`-u`** - выводит только подлинный числовой идентификатор пользователя
   
